<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Weather Analysis | ITECH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            background-image: url('https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }
        #map { height: 400px; width: 100%; border-radius: 1rem; border: 4px solid white; z-index: 1; }
        .weather-card { transition: transform 0.2s ease; }
    </style>
</head>
<body class="min-h-screen font-sans pb-20">
    
    <div class="bg-black/30 backdrop-blur-sm sticky top-0 z-[1000] py-4 px-6 text-center text-white border-b border-white/10">
        <h1 class="text-xl font-bold tracking-tighter uppercase">Babatunde Abass</h1>
        <p class="text-[10px] tracking-widest opacity-80 uppercase">Geospatial Data Analyst Dashboard</p>
    </div>

    <div class="max-w-7xl mx-auto p-6 mt-6">
        <div class="bg-white/90 backdrop-blur-md p-6 rounded-2xl shadow-2xl flex flex-col md:flex-row gap-4 items-center mb-6 border border-white">
            <input id="cityInput" type="text" placeholder="Lagos, London, Tokyo, Ibadan..." 
                class="w-full md:flex-1 p-3 rounded-lg border border-slate-200 bg-white text-slate-800 outline-none focus:ring-2 focus:ring-blue-500">
            <div class="flex gap-2 w-full md:w-auto">
                <button onclick="getMultiWeather()" class="bg-indigo-900 text-white px-8 py-3 rounded-lg font-bold hover:bg-indigo-800 flex-1 md:flex-none">Analyze Global Data</button>
                <button onclick="clearAll()" class="bg-red-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-red-600">Clear All</button>
            </div>
        </div>

        <div class="bg-white/80 backdrop-blur-md p-2 rounded-2xl shadow-2xl mb-10">
            <div id="map"></div>
        </div>

        <div id="weatherGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize Map
        const map = L.map('map').setView([9.0820, 8.6753], 3); // Centered on Nigeria/Africa
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        let markers = [];

        async function getMultiWeather() {
            const input = document.getElementById('cityInput').value;
            const grid = document.getElementById('weatherGrid');
            const apiKey = 'aad4cbdae56d6d693c4f99064fe46dcd';
            
            const cities = input.split(',').map(c => c.trim()).filter(c => c !== "");
            if (cities.length === 0) return;

            for (let city of cities) {
                try {
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`);
                    const data = await response.json();
                    if (data.cod !== 200) continue;

                    // 1. Add Marker to Map
                    const lat = data.coord.lat;
                    const lon = data.coord.lon;
                    const marker = L.marker([lat, lon]).addTo(map)
                        .bindPopup(`<b>${data.name}</b><br>${Math.round(data.main.temp)}°C`)
                        .openPopup();
                    markers.push(marker);
                    map.setView([lat, lon], 4);

                    // 2. Create Card
                    const card = document.createElement('div');
                    card.className = "weather-card bg-white rounded-xl shadow-lg border-t-4 border-indigo-900 p-6 flex flex-col items-center text-center animate-in fade-in zoom-in duration-300";
                    card.innerHTML = `
                        <h3 class="text-indigo-900 font-black text-xl mb-1">${data.name}</h3>
                        <p class="text-slate-400 text-[11px] mb-4">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                        <img src="https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png" class="w-16 h-16">
                        <p class="text-slate-800 text-4xl font-black my-4">${Math.round(data.main.temp)}.0°C</p>
                        <p class="text-slate-500 text-[11px] font-bold uppercase tracking-widest border-t border-slate-100 pt-4 w-full">${data.weather[0].description}</p>
                    `;
                    grid.prepend(card); // Put newest city at the beginning
                } catch (error) { console.error(error); }
            }
            document.getElementById('cityInput').value = "";
        }

        function clearAll() {
            document.getElementById('weatherGrid').innerHTML = '';
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            map.setView([9.0820, 8.6753], 3);
        }

        document.getElementById('cityInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') getMultiWeather(); });
    </script>
</body>
</html>